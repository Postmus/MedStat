{
  "hash": "4545462c92e076f3c82f9fcc3a7236fa",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Medical Statistics – Lab 3\"\nsubtitle: R version\nformat: \n  html:\n    toc: true       \n    toc-depth: 3    \n    toc-location: right\n  pdf:\n    toc: false \nexecute:\n  warning: false\n  message: false\n  eval: false\n  echo: true     \n---\n\nWelcome to lab 3 in the medical statistics course. For today's exercises, we will continue exploring the `lowbwt.sav` dataset, which you can downloaded from the Dataset section of the menu. In this lab, we will use the following R packages: `haven`, `dplyr`, `ggplot2`, `car`, and `dunn.test`. The first three packages were also used in the previous labs and therefore already installed on your computer. For `car` (used to perform Levene's test) and `dunn.test` (used to perform Dunn's post-hoc test) you may have to download and install them first by running `install.packages(c(\"car\", \"dunn.test\"))`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the required packages\nlibrary(haven)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(car)\nlibrary(dunn.test)\n\n# Load the dataset\n#lowbwt <- read_sav(\"lowbwt.sav\")\nlowbwt <- read_sav(\"datasets/lowbwt.sav\")\n\n# Convert all variables to factors where needed\nlowbwt <- lowbwt |> mutate(across(where(is.labelled), as_factor))\n```\n:::\n\n\nAs a reminder, the dataset includes the following variables (see the previous lab for more details):\n\n| Variable | Abbreviation |\n| --- | --- |\n| Identification Code | ID |\n| Low Birth Weight (0 = Birth Weight ≥ 2500g, 1 = Birth Weight < 2500g) | low |\n| Age of the Mother in Years | age |\n| Weight in Pounds at the Last Menstrual Period | lwt |\n| Ethnicity of the mother  (1 = Caucasian, 2 = Afro-American, 3 = Asian) | ethnicity |\n| Smoking Status During Pregnancy (1 = Yes, 0 = No) | smoke |\n| History of Premature Labor (0 = None, 1 = One, etc.) | ptl |\n| History of Hypertension (1 = Yes, 0 = No) | ht |\n| Presence of Uterine Irritability (1 = Yes, 0 = No) | urirr |\n| Number of Physician Visits During the First Trimester (0 = None, 1 = One, 2 = Two, etc.) | pvft |\n| Birth Weight in Grams | bwt |\n\n## Part 1: Independent Samples t-test and Mann-Whitney U Test\n\nIn this part of the lab, we will examine the effect of smoking during pregnancy on birth weight.\n\n### Exploratory data analysis\n\nWe will start by creating a boxplot to visualize the distribution of birth weights for mothers who smoked and those who did not.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create boxplot comparing birth weights for mothers who smoked and those who did not\nggplot(lowbwt, aes(x = smoke, y = bwt)) +\n  geom_boxplot() +\n  labs(x = \"Smoking Status\", y = \"Birth Weight (grams)\", title = \"Birth Weight by Smoking Status\")\n```\n:::\n\n\n::: {.callout-important icon=false title=\"Question 1\"}\nBased on the boxplot, do you expect the smoking status to have an effect on birth weight?\n:::\n\n### Independent samples t-test\n\nNext, we will perform an independent samples t-test to compare the mean birth weights between mothers who smoked and those who did not. In R, this can be done using the `t.test()` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Perform independent samples t-test\nindependent_t_test <- t.test(bwt ~ smoke, data = lowbwt, var.equal = TRUE)\n\n# Print results\nprint(independent_t_test)\n```\n:::\n\n\n**Explanation**:\n\n- The first argument `bwt ~ smoke` specifies the formula for the test, indicating that we are comparing the birth weights (`bwt`) between the two groups defined by the `smoke` variable.\n- The second argument `data = lowbwt` specifies the dataset.\n- The argument `var.equal = TRUE` indicates that we are assuming equal variances in the two groups, meaning that the classical independent samples t-test is performed. If you suspect unequal variances, the Welch t-test can be conducted by setting `var.equal = FALSE`.\n\n::: {.callout-important icon=false title=\"Question 2\"}\nBased on the results of the independent samples t-test, is there a statistically significant difference in birth weight between mothers who smoked and those who did not?\n:::\n\n### Checking of assumptions\n\nTo assess whether the assumption of normality holds for the outcome variable in both groups, we create the following plot:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create histograms of birth weight by smoking status\nggplot(lowbwt, aes(x = bwt)) +\n  geom_histogram(binwidth = 200, fill = \"blue\", colour=\"black\", alpha = 0.7) +\n  facet_wrap(~smoke) +\n  labs(x = \"Birth Weight (grams)\", title = \"Histograms of Birth Weight by Smoking Status\")\n```\n:::\n\n\n::: {.callout-important icon=false title=\"Question 3\"}\nDo the histograms indicate that the birth weight data are approximately normally distributed for both groups?\n:::\n\nWe also need to check whether the assumption of a common population standard deviation holds. This can be done by performing Levene's test:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Perform Levene's test for homogeneity of variances\nlevene_test <- leveneTest(bwt ~ smoke, data = lowbwt)\nlevene_test\n```\n:::\n\n\n::: {.callout-important icon=false title=\"Question 4\"}\nBased on Levene's test, does the assumption of equal variances hold?\n:::\n\n### 95% Confidence Interval for the mean difference\n\nIn addition to performing hypothesis tests, it is often informative to estimate the effect size and its uncertainty. One way to do this is by calculating a confidence interval for the mean difference in birth weight between the two groups. The 95% confidence interval is included in the default output of the `t.test()` function, so in principle we could extract it from there. As an exercise, we are also going to calculate it manually based on the formulas provided in the lecture/course syllabus.\n\nTo calculate the summary statistics required for the manual calculation, we use the following code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate summary statistics by smoking status\nsummary_stats <- lowbwt |>\n  group_by(smoke) |>\n  summarise(\n    mean = mean(bwt),\n    sd = sd(bwt),\n    n = n(),\n    .groups = \"drop\"\n  )\nsummary_stats\n```\n:::\n\n\n::: {.callout-important icon=false title=\"Exercise\"}\nBased on these summary statistics, calculate the pooled standard deviation and the standard error of the mean difference. Then compute the 95% confidence interval for the mean difference in birth weight between mothers who smoked and those who did not. \n:::\n\n::: {.callout-important icon=false title=\"Question 5\"}\nDoes your manually calculated 95% confidence interval for the mean difference in birth weight between the two groups agree with the one provided in the output of the `t.test()` function?\n:::\n\n### Mann-Whitney U Test\n\nIn case the assumptions of the independent samples t-test are violated, we can use the Mann-Whitney U test as a non-parametric alternative. This test can be performed in R using the `wilcox.test()` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Perform Mann-Whitney U test\nwilcoxon_test <- wilcox.test(bwt ~ smoke, data = lowbwt)\nwilcoxon_test\n```\n:::\n\n\n::: {.callout-important icon=false title=\"Question 6\"}\nWhat are the null and alternative hypotheses for the Mann-Whitney U test, and what does the p-value indicate about the difference in birth weight between mothers who smoked and those who did not?\n:::\n\n## Part 2: One-Way ANOVA and Kruskal-Wallis Test\n\nIn this part of the lab, we are going to examine the effect of ethnicity on birth weight.\n\n### Explaratory data analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create boxplot comparing birth weights across ethnic groups\nggplot(lowbwt, aes(x = ethnicity, y = bwt)) +\n  geom_boxplot() +\n  labs(x = \"Ethnicity\", y = \"Birth Weight (grams)\", title = \"Birth Weight by Ethnicity\")\n```\n:::\n\n\n::: {.callout-important icon=false title=\"Question 7\"}\nWhat does the boxplot suggest about the distribution of birth weights across different ethnic groups?\n:::\n\n### One-way ANOVA\n\nTo test the null hypothesis that the mean birth weights are equal across all ethnic groups, we can perform a one-way ANOVA using the `aov()` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Perform One-Way ANOVA\nanova_result <- aov(bwt ~ ethnicity, data = lowbwt)\n\n# Print summary of ANOVA\nsummary(anova_result)\n```\n:::\n\n\n::: {.callout-important icon=false title=\"Question 8\"}\nWhat conclusions can be drawn from the results of the one-way ANOVA?\n:::\n\n### Post-hoc tests\n\nIf the one-way ANOVA indicates a statistically significant difference in birth weight across ethnic groups, we can perform Bonferroni-corrected post-hoc tests to determine which specific groups differ from each other. In R, this can be done using the `pairwise.t.test()` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Perform pairwise comparisons with Bonferroni correction\nposthoc <- pairwise.t.test(lowbwt$bwt, lowbwt$ethnicity, p.adjust.method = \"bonferroni\")\nposthoc\n```\n:::\n\n\n**Explanation**:\n\n- The first argument of the `pairwise.t.test()` function specifies the outcome variable, which is the column of the lowbwt dataset that contains the birth weight values\n- The second argument specifies the grouping variable, which is the column of the lowbwt dataset that contains the ethnicity values\n- The `p.adjust.method = \"bonferroni\"` argument specifies that the p-values should be adjusted using the Bonferroni correction\n\n::: {.callout-important icon=false title=\"Question 9\"}\nWhat conclusions can be drawn from the post-hoc comparisons?\n:::\n\n### Checking of assumptions\n\nTo assess whether the results of the one-way ANOVA are valid, we need to check the assumptions of normality and homogeneity of variances. This step is analogous to the previous examples, and is left as an exercise.\n\n### Kruskal-Wallis Test\n\nIf the assumptions of the one-way ANOVA are violated, we can use the Kruskal-Wallis test as a non-parametric alternative. The test can be performed in R using the `kruskal.test()` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Perform Kruskal-Wallis test\nkruskal_test <- kruskal.test(bwt ~ ethnicity, data = lowbwt)\nkruskal_test\n```\n:::\n\n\n::: {.callout-important icon=false title=\"Question 10\"}\nAre the results of the Kruskal-Wallis test consistent with the one-way ANOVA results? \n:::\n\n### Post-hoc tests for Kruskal-Wallis\n\nIf the Kruskal-Wallis test indicates a statistically significant difference between groups, we can perform Dunn's test as a post-hoc analysis to determine which specific groups differ from each other. Dunn's test is the non-parametric equivalent of the pairwise t-tests used after ANOVA.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Perform Dunn's test with Bonferroni correction\ndunn_test <- dunn.test(lowbwt$bwt, lowbwt$ethnicity, method = \"bonferroni\", altp = TRUE)\ndunn_test\n```\n:::\n\n\n**Explanation**:\n\n- The first argument specifies the outcome variable (birth weight)\n- The second argument specifies the grouping variable (ethnicity)\n- The `method = \"bonferroni\"` argument specifies that the p-values should be adjusted using the Bonferroni correction\n- The `altp = TRUE` argument ensures that two-sided p-values are reported\n\n::: {.callout-important icon=false title=\"Question 11\"}\nWhat conclusions can be drawn from Dunn's test? Are these consistent with the post-hoc comparisons from the one-way ANOVA?\n:::\n\n## Part 3: Unguided exercises\n\n### Effect of hypertension on birth weight\n\nExamine the effect of history of hypertension on birth weight by performing the following steps:\n\n- Create a boxplot to visualize the distribution of birth weights by history of hypertension\n- Perform an independent samples t-test to compare the mean birth weights between mothers with and without a history of hypertension\n- Check the assumptions of the t-test, including normality and homogeneity of variances\n- If the assumptions of the t-test are violated, perform a Mann-Whitney U test as a non-parametric alternative\n\n### Comparing red cell folate levels across ventilation strategies in cardiac bypass patients\n\nTwenty-two patients undergoing cardiac bypass surgery were randomized to one of three ventilation groups:\n\n- **Group I**: Received a 50% nitrous oxide and 50% oxygen mixture continuously for 24 hours\n- **Group II**: Received a 50% nitrous oxide and 50% oxygen mixture only during the operation\n- **Group III**: Received no nitrous oxide and a 35-50% oxygen mixture continuously for 24 hours\n\nThe data file `ex5_6.sav` contains the red cell folate levels for the three groups after 24 hours of ventilation. The aim of this study is to compare the three groups and test whether they have the same red cell folate levels.\n\n#### Tasks\n\n1. **Exploratory data analysis**  Create a boxplot to visualize the distribution of red cell folate levels by ventilation group. Based on this plot:\n   - What are your first conclusions regarding the means and variances of the different groups?\n2. **Perform a one-way ANOVA**:\n   - Interpret the results\n   - Are the assumptions satisfied?\n3. **Try a log transformation on the data**:\n   - Perform another one-way ANOVA\n   - Are the assumptions satisfied after the transformation?\n4. **Determine which means differ**:\n   - Which means do you think differ?\n   - Explain your reasoning.\n5. **Try a non-parametric approach**:\n   - What are your conclusions from this method?\n\n\n\n",
    "supporting": [
      "R_lab3_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}