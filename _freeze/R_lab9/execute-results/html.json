{
  "hash": "413b1ca26af27da39a88df7a05792b3f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Medical Statistics – Lab 9\"\nsubtitle: R version\nformat:\n  html:\n    toc: true       \n    toc-depth: 3    \n    toc-location: right\n    code-overflow: wrap \n  pdf:\n    toc: false\nexecute:\n  warning: false\n  message: false\n  error: false\n  eval: false\n---\n\n# Part 1: Analysis of overall survival in the Worcester Heart Attack study\n\nIn this section, we are going to continue analyzing the Worcester Heart Attack Study (WHAS) dataset (file `whas500.sav`). The outcome of interest for today's analysis is overall survival, defined as the time from hospital admission to death from any cause. This information is captured in the variable `lenfol` (length of follow-up in days) and the variable `fstat` (follow-up status; dead or censored).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(haven)   # for reading SPSS files\nlibrary(dplyr)   # for data manipulation\nlibrary(survival)  # for performing survival analysis\n\n# Load the dataset\nwhas500 <- read_sav(\"datasets/whas500.sav\")\n\n# Convert labeled variables to factors\nwhas500 <- whas500 %>%\n  mutate(across(where(is.labelled), as_factor))\n\n# Create a numerical variable for follow-up status (1 = dead, 0 = censored)\nwhas500$fstat_numeric <- ifelse(whas500$fstat==\"dead\", 1, 0)\n```\n:::\n\n\n## Association between MI order and overall survival\n\nThe variable `miord` represents the sequence of myocardial infarction (MI) events, categorized as either a first MI or a recurrent MI. Our aim is to analyze the relationship between MI order and overall survival outcomes.\n\n### Kaplan-Meier survival curves and logrank test\n\nWe start by constructing a Kaplan-Meier survival curve to compare the survival probabilities between patients with a first MI and those with a recurrent MI:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Kaplan-Meier by MI order\ngroup_fit <- survfit(Surv(lenfol, fstat_numeric) ~ miord, data = whas500)\nsummary(group_fit)\n\nplot(group_fit, col = c(\"blue\", \"red\"), xlab = \"Follow-up Time (days)\", ylab = \"Survival Probability\", main = \"Survival by MI Order\")\nlegend(\"topleft\", legend = c(\"First MI\", \"Recurrent MI\"), col = c(\"blue\", \"red\"), lty = 1)\n```\n:::\n\n\n**Explanation of the code:**\n\n- The `survfit()` function is used to fit a Kaplan-Meier survival curve for the two groups defined by the `miord` variable.\n- The formula `Surv(lenfol, fstat) ~ miord` specifies the survival time and event status as the response variables and the MI order as the predictor.\n- `summary(group_fit)` provides the survival probabilities at different time points for each group.\n- The `plot()` function is used to visualize the Kaplan-Meier curves for the two groups.\n\n::: {.callout-important icon=false title=\"Question 1\"}\nBased on the Kaplan-Meier table, what are the estimated survival probabilities at 3 years for patients with a first MI and those with a recurrent MI?\n:::\n\n::: {.callout-important icon=false title=\"Question 2\"}\nBased on the Kaplan-Meier curves, do you observe any differences in survival times between patients with a first MI and those with a recurrent MI?  \n:::\n\nTo formally test the difference in survival between the two groups, we can use the logrank test:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Logrank test\nsurvdiff(Surv(lenfol, fstat_numeric) ~ miord, data = whas500)\n```\n:::\n\n\n::: {.callout-important icon=false title=\"Question 3\"}\nBased on the results of the logrank test, is there a significant difference in overall survival between patients with a first MI and those with a recurrent MI?\n:::\n\n### Cox regression\n\nNext, we will perform a Cox proportional hazards regression analysis to assess the association between MI order and overall survival while adjusting for potential confounders. We will start with the unadjusted model:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Unadjusted Cox regression\ncoxph_model_unadj <- coxph(Surv(lenfol, fstat_numeric) ~ miord, data = whas500)\nsummary(coxph_model_unadj)\n```\n:::\n\n\n**Explanation of the code:** \n\n- The `coxph()` function is used to fit a Cox proportional hazards regression model with the survival time and event status as the response variables and the MI order as the predictor. \n- The `summary()` function provides the estimated hazard ratio (HR) and its significance.\n\n::: {.callout-important icon=false title=\"Question 4\"}\nWhat is the hazard ratio (HR) for patients with a recurrent MI compared to those with a first MI based on the unadjusted Cox regression model?\n:::\n\n::: {.callout-important icon=false title=\"Question 5\"}\nDoes the result of the Cox regression model support the findings from the logrank test regarding the association between MI order and overall survival?\n:::\n\nNow, let's adjust the Cox regression model using `age` and `gender` as potential confounders:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Adjusted Cox regression\ncoxph_model_adj <- coxph(Surv(lenfol, fstat_numeric) ~ miord + age + gender, data = whas500)\nsummary(coxph_model_adj)\n```\n:::\n\n\n::: {.callout-important icon=false title=\"Question 6\"}\nAfter adjusting for age and gender, what is the hazard ratio (HR) for patients with a recurrent MI compared to those with a first MI? How does this compare to the unadjusted HR? Can you explain the change in the HR after adjusting for these variables?\n:::\n\n# Part 2: Unguided exercises\n\n### Excercise 1\n\nFile `Ex9_1.sav` (available from the Datasets menu) contains data from a small experiment concerning motion sickness at sea (Burns, 1984). Subjects were placed in a cabin subjected to vertical motion for two hours. The outcome variable was the waiting time to emesis (vomiting). Some subjects requested an early stop to the experiment although they had not vomited, yielding censored observations, while others successfully survived two hours. The experiment was carried out with two \"treatments\": two combinations of movement accelerations and frequency. One combination was used for a group of 21 subjects, the other in a different group of 28 subjects.\n\n(a) Calculate and plot Kaplan-Meier estimates of survival probabilities in the two groups.\n\n(b) Calculate the 95% CI for the difference between survival probabilities of the two groups after 60 minutes.\n\n(c) Compare the two survival curves by logrank test.\n\n(d) Use Cox regression to compare the two treatments; compare the result to that of the logrank test; calculate the hazard ratio and its 95% CI.\n\n(e) Two different persons undergo the experiment with different treatments. Estimate the probability that the waiting time until emesis under one of the treatments exceeds that under the other treatment.\n\n### Exercise 2\n\nSubfertile women with a child wish may receive an in-vitro fertilization (IVF) treatment. In an observational study the waiting time until pregnancy was recorded. The women undergoing the IVF treatment were categorized (prior to the start of the treatment) in four groups, A, B, C and D, with respect to the type of infertility. The waiting times – some of them censored - of the groups were compared by means of Cox regression with the group variable entered as a categorical variable. The P-value of the Wald test with 3 df was 0.095. The dummy-variables v1, v2 and v3 were defined as follows:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](images/ch9-img-2.png)\n:::\n:::\n\n\nThe hazard ratios and P-values for the dummy variables v1, v2 and v3 were reported as 1.20 (P=0.30), 2.80 (P=0.02) and 1.05 (P=0.48).\n\n(a) Which group is estimated to have the longest waiting time for pregnancy?\n\n(b) A researcher compared all pairs of groups by separate tests. She used the Bonferroni method to keep the type-I error of the entire procedure below 10%. Which differences were found to be significant?\n\n(c) Which assumptions are needed for the validity of Cox regression in this case?\n\n### Exercise 3\n\nRelation between survival and a number of variables was studied in 37 patients having a bone marrow transplant. Cox regression analysis using the occurrence of acute graft-versus-host disease (GvHD=1 if present and GvHD=0 if absent), diagnosis, recipient’s age and sex, donor’s age and sex, whether the donor had been pregnant and the type of the leukemia (CML=1 if chronic myeloid leukemia and CML=0 otherwise) yielded the following model:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](images/ch9-img-3.png)\n:::\n:::\n\n\n(a) What is the interpretation of the opposite signs for the regression coefficients?\n\n(b) Calculate the relative risks of dying (hazard ratio) for the following patients relative to non-GvHD non-CML patients (i) with GvHD but not CML, (ii) CML but without GvHD, (iii) CML and GvHD.\n",
    "supporting": [
      "R_lab9_files\\figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}