{
  "hash": "9b7c70c7e0520257b66ee635cc70e455",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Medical Statistics – Lab 6\"\nsubtitle: R version\nformat:\n  html:\n    toc: true       \n    toc-depth: 3    \n    toc-location: right\n    code-overflow: wrap \n  pdf:\n    toc: false\nexecute:\n  warning: false\n  message: false\n  error: false\n  eval: false\n---\n\nWelcome to lab 6 on correlation and linear regression. In today’s exercises, we will be analyzing a dataset named `pockets.sav`, which you can download from the Datasets menu. This dataset contains measurements of periodontal pocket depth for a group of individuals, along with several demographic and lifestyle variables.\n\nBelow is an overview of the variables we will be working with:\n\n| Variable      | Description                                                                     |\n|---------------|---------------------------------------------------------------------------------|\n| `pocketdepth` | Pocket depth measurement in millimeters (continuous)                            |\n| `sex`         | Sex (categorical: \"Female\" / \"Male\")                                            |\n| `age`         | Age in years (continuous)                                                       |\n| `smoking`     | Smoking status (categorical: \"Non-smoker\" / \"Smoker\")                           |\n| `alcohol`     | Alcohol consumption categories (e.g., \"None\", \"1–2 glasses/day\", \">2 glasses/day\") |\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(haven)   # for reading SPSS files\nlibrary(dplyr)   # for data manipulation\nlibrary(ggplot2) # for data visualization\nlibrary(car)    # for calculating type-III ANOVA tables\n\n# Load the dataset\npockets <- read_sav(\"pockets.sav\")\n\n# Convert labeled variables to factors\npockets <- pockets %>%\n  mutate(across(where(is.labelled), as_factor))\n```\n:::\n\n\n\n\n## Part 1: Pearson's correlation coefficient and simple linear regression\n\nIn this section, we will investigate whether **age** is associated with **pocket depth**. We start by creating a scatterplot to visualize the relationship between `pocketdepth` and `age`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Scatterplot of pocket depth vs. age\nggplot(pockets, aes(x = age, y = pocketdepth)) +\n  geom_point() +\n  labs(\n    x     = \"Age (years)\",\n    y     = \"Pocket Depth (mm)\",\n    title = \"Scatterplot of Pocket Depth vs Age\"\n  )\n```\n:::\n\n\n::: {.callout-important icon=false title=\"Question 1\"}\nBased on the scatterplot, is there an indication of a linear association between `age` and `pocketdepth`? If so, is this association positive or negative?\n:::\n\n### Pearson's Correlation Coefficient\n\nTo quantify the strength and direction of the linear relationship between `age` and `pocketdepth`, we can calculate Pearson's correlation coefficient:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate Pearson's correlation coefficient\ncor(pockets$age, pockets$pocketdepth, use=\"complete.obs\")\n```\n:::\n\n\nThe argument `use = \"complete.obs\"` tells R to exclude any missing values when calculating the correlation coefficient. In this case, there are no missing values in the `age` and `pocketdepth` variables, meaning that the argument is not strictly necessary. However, it is good practice to include it to avoid potential issues with missing data in other datasets.\n\n::: {.callout-important icon=false title=\"Question 2\"}\nWhat does the correlation coefficient tell us about the relationship between `age` and `pocketdepth`? Does this align with your interpretation of the scatterplot?\n:::\n\nWe can also test whether the correlation coefficient is significantly different from zero using a hypothesis test. The null hypothesis is that the correlation coefficient is zero (i.e., no linear relationship between the variables), and the alternative hypothesis is that the correlation coefficient is not zero. In R, we can perform this test using the `cor.test()` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Test the significance of the correlation coefficient\ncor_test <- cor.test(pockets$age, pockets$pocketdepth)\ncor_test\n```\n:::\n\n\n::: {.callout-important icon=false title=\"Question 3\"}\nWhat is the p-value for the correlation coefficient test? Based on this p-value, do we have sufficient evidence to reject the null hypothesis?\n:::\n\n### Fitting a Simple Linear Regression Model\n\nNext, we fit a simple linear regression model to quantify the relationship between `age` and `pocketdepth`. In R, this can be achieved using the `lm()` function: \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit a simple linear regression model\nmodel_slr <- lm(pocketdepth ~ age, data = pockets)\n\n# Print the summary of the model\nsummary(model_slr)\n```\n:::\n\n\nThe formula `pocketdepth ~ age` specifies that `pocketdepth` is the dependent variable and `age` is the independent variable. The intercept term is included by default in the linear regression model and is therefore not explicitly specified in the formula.\n\n::: {.callout-important icon=false title=\"Question 4\"}\nIs the relationship between `age` and `pocketdepth` statistically significant (at α = 0.05)?\n:::\n\n::: {.callout-important icon=false title=\"Question 5\"}\nHow does the p-value for `age` in the regression output compare to the p-value for the correlation coefficient test? Are they consistent with each other?\n:::\n\n::: {.callout-important icon=false title=\"Question 6\"}\nWhat is the interpretation of the intercept and the coefficient for `age` in the regression output? \n:::\n\n::: {.callout-important icon=false title=\"Question 7\"}\nBased on the fitted model, what is the expected pocket depth for a person who is 40 years old?\n:::\n\n::: {.callout-important icon=false title=\"Question 8\"}\nHow much of the variation in pocket depth is explained by age in this model?\n:::\n\n\n### Assumption Checking\n\nTo obtain diagnostic plots for the simple linear regression model, we can supply the fitted model to the `plot()` function. By default, R will generate four diagnostic plots. In this lab, we are going to focus on the following two plots:\n\n- Q-Q Plot: This plot helps us assess the normality of the residuals. This plot can be obtained by setting `which = 2` in the `plot()` function.\n- Residuals vs. Fitted: This plot helps us check for homoscedasticity (constant variance) and linearity assumptions. This plot can be obtained by setting `which = 1` in the `plot()` function.\n\n#### Normality of Residuals\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(model_slr, which = 2)  # Q-Q plot\n```\n:::\n\n\nIn addition to the Q-Q plot, we can also create a histogram of the residuals to visually inspect their distribution:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Histogram of residuals\nhist(residuals(model_slr), breaks = 15, col = \"lightblue\", \n     border = \"black\", main = \"Histogram of Residuals\", \n     xlab = \"Residuals\")\n```\n:::\n\n\n::: {.callout-important icon=false title=\"Question 9\"}\nDo the histogram and Q-Q plot suggest that the residuals are reasonably normally distributed?\n:::\n\n#### Homoscedasticity and linearity\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(model_slr, which = 1)  # residuals vs fitted\n```\n:::\n\n\n::: {.callout-important icon=false title=\"Question 10\"}\nDoes the residual-versus-fitted plot suggest constant variance?\n:::\n\nThe red line in R’s default residual-versus-fitted plot is a LOESS (locally estimated scatterplot smoothing) curve that shows the average trend in the residuals. It helps you see if there is a systematic pattern (e.g., curvature) that might indicate the linear model is misspecified. Ideally, you want that red line to be close to horizontal (i.e., around zero) with no strong curvature, suggesting that the linear fit is appropriate and there’s no obvious nonlinearity or other systematic pattern left in the residuals.\n\n::: {.callout-important icon=false title=\"Question 11\"}\nDoes the residual-versus-fitted plot suggest any violation of the linearity assumption?\n:::\n\n## Part 2: ANCOVA (Analysis of Covariance)\n\nIn this section, we will fit an ANCOVA model to determine whether alcohol consumption is associated with pocket depth, controlling for age.\n\n### Exploratory Data Analysis\n\nWe start by creating a scatterplot to visualize the relationship between `age` and `pocketdepth`, using different colors to represent the levels of `alcohol`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Scatterplot of pocketdepth vs. age, colored by alcohol\nggplot(pockets, aes(x = age, y = pocketdepth, color = alcohol)) +\n  geom_point() +\n  labs(title = \"Scatterplot of Pocket Depth vs. Age by Alcohol Consumption\", \n       x = \"Age\", y = \"Pocket Depth\") +\n  theme_minimal() +\n  theme(legend.position = \"bottom\")\n```\n:::\n\n\n::: {.callout-important icon=false title=\"Question 12\"}\nWhat can you infer from the scatterplot about the relationship between `age`, `pocketdepth`, and `alcohol` consumption?\n:::\n\n### Dummy Coding for `alcohol`\n\nThe variable `alcohol` has three categories (e.g., `\"None\"`, `\"1-2 glasses/day\"`, and `\">2 glasses/day\"`), meaning that we need to create two dummy variables to represent these categories in the model. R automatically generates these dummy variables once `alcohol` is recognized as a factor. To check if `alcohol` is a factor, we can use the `is.factor()` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check whether alcohol is a factor\nis.factor(pockets$alcohol)\n```\n:::\n\n\nIn this case, the output should be `TRUE`, given that we converted all categorical variables to factors when loading the dataset. Should `alcohol` not be a factor, we can either convert it to a factor using the `factor()` function or specify it as a factor in the model formula.\n\n### Fitting the ANCOVA Model\n\nTo fit the ANCOVA model, we can use the `lm()` function in R. The formula for the ANCOVA model is specified as `pocketdepth ~ age + alcohol`, where `age` is the continuous predictor and `alcohol` is the categorical predictor. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_ancova <- lm(pocketdepth ~ age + alcohol, data = pockets)\nsummary(model_ancova)\n```\n:::\n\n\n::: {.callout-note}\nNote that R uses the first level of a factor (alphabetically or numerically) as the default reference category. In this dataset, \"None\" is the reference category.\n:::\n\n::: {.callout-important icon=false title=\"Question 13\"}\nBased on the ANCOVA model output, what is the expected difference in pocket depth between individuals who consume `\"None\"` and those who consume `\">2 glasses/day\"`, while controlling for age?\n:::\n\n::: {.callout-important icon=false title=\"Question 14\"}\nBased on the ANCOVA model output, what is the expected difference in pocket depth between individuals who consume `\"1-2 glasses/day\"` and those who consume `\">2 glasses/day\"`, while controlling for age?\n:::\n\nTo test the overall significance of the `alcohol` variable as a predictor of `pocketdepth`, we construct an analysis of variance (ANOVA) table. The ANOVA table summarizes how much each term in a linear regression model contributes to explaining the overall variation in the response variable. There are different ways to construct this table depending on how the sum of squares is partitioned among model terms. A common approach is Type III ANOVA, which evaluates each variable or interaction after all other terms have been accounted for. Each effect is tested as if it were entered last, so its sum of squares reflects the unique contribution of that variable or interaction beyond what is already explained by the remaining terms. \n\nTo obtain the type III ANOVA table, we use the `Anova()` function from the `car` package. This function provides a more detailed ANOVA output compared to the base R `anova()` function, and has an argument `type` that allows you to specify the type of sum of squares to use: \n \n\n::: {.cell}\n\n```{.r .cell-code}\nAnova(model_ancova, type=\"III\")\n```\n:::\n\n\n::: {.callout-important icon=false title=\"Question 15\"}\nBased on the ANOVA table, is the `alcohol` variable significantly associated with `pocketdepth` after accounting for `age`?\n:::\n\n### Model Diagnostics\n\n::: {.callout-important icon=false title=\"Exercise\"}\nCheck the normality of residuals and homoscedasticity assumptions for the ANCOVA model.\n:::\n\n## Part 3: Interactions in ANCOVA\n\nIn some cases, the relationship between the outcome variable and a predictor may depend on the level of another predictor. This is known as an interaction effect. In the context of ANCOVA, we can test for interactions between the continuous predictor (`age`) and the categorical predictor (`alcohol`).\n\n### Fitting the Interaction Model\n\nTo include an interaction term in the model, we can use the `:` operator in the formula. That is, the interaction term between `age` and `alcohol` can be specified as `age:alcohol`. With this term, the interaction model can be specified as `pocketdepth ~ age + alcohol + age:alcohol`. A short form for specifying the interaction model is `pocketdepth ~ age * alcohol`, which includes both the main effects of `age` and `alcohol` and their interaction terms. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_interaction <- lm(pocketdepth ~ age * alcohol, data = pockets)\nsummary(model_interaction)\n```\n:::\n\n\nTo test the significance of the interaction term, we again use the `Anova()` function from the `car` package:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nAnova(model_interaction, type=\"III\")\n```\n:::\n\n\n::: {.callout-important icon=false title=\"Question 16\"}\nBased on the output in the ANOVA table, is there a significant interaction between `age` and `alcohol` in predicting `pocketdepth`?\n:::\n\n## Part 4: Relationship Between Smoking and Pocket Depth\n\nIn addition to information about alcohol consumption, the dataset also contains information about smoking habits. Explore the relationship between smoking and pocket depth, and how it interacts with age. You can use the same approach as in the previous sections to fit models, test for significance, and check assumptions.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}