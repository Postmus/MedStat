<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Advanced Medical Statistics – Answers lab 7 – Advanced Statistics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Advanced Statistics</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs-week-1" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Labs week 1</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs-week-1">    
        <li>
    <a class="dropdown-item" href="./R_lab1.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./SPSS_lab1.html">
 <span class="dropdown-text">SPSS</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs-week-2" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Labs week 2</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs-week-2">    
        <li>
    <a class="dropdown-item" href="./R_lab2.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./SPSS_lab2.html">
 <span class="dropdown-text">SPSS</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs-week-3" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Labs week 3</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs-week-3">    
        <li>
    <a class="dropdown-item" href="./R_lab3.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./SPSS_lab3.html">
 <span class="dropdown-text">SPSS</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs-week-4" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Labs week 4</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs-week-4">    
        <li>
    <a class="dropdown-item" href="./R_lab4.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./SPSS_lab4.html">
 <span class="dropdown-text">SPSS</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs-week-6" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Labs week 6</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs-week-6">    
        <li>
    <a class="dropdown-item" href="./R_lab6.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./SPSS_lab6.html">
 <span class="dropdown-text">SPSS</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lab-week-7" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lab week 7</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lab-week-7">    
        <li>
    <a class="dropdown-item" href="./lab7.html">
 <span class="dropdown-text">Exercises</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs-week-8" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Labs week 8</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs-week-8">    
        <li>
    <a class="dropdown-item" href="./R_lab8.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./SPSS_lab8.html">
 <span class="dropdown-text">SPSS</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-answers" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Answers</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-answers">    
        <li>
    <a class="dropdown-item" href="./lab1_answers.html">
 <span class="dropdown-text">Week 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab2_answers.html">
 <span class="dropdown-text">Week 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab3_answers.html">
 <span class="dropdown-text">Week 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab4_answers.html">
 <span class="dropdown-text">Week 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab6_answers.html">
 <span class="dropdown-text">Week 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab7_answers.html">
 <span class="dropdown-text">Week 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab8_answers.html">
 <span class="dropdown-text">Week 8</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-assignments" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Assignments</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-assignments">    
        <li>
    <a class="dropdown-item" href="./Assignment_1.html">
 <span class="dropdown-text">Assignment part 1</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#part-1-building-prediction-models-using-backward-elimination" id="toc-part-1-building-prediction-models-using-backward-elimination" class="nav-link active" data-scroll-target="#part-1-building-prediction-models-using-backward-elimination">Part 1: Building prediction models using backward elimination</a>
  <ul class="collapse">
  <li><a href="#step-1-fit-the-initial-linear-regression-model" id="toc-step-1-fit-the-initial-linear-regression-model" class="nav-link" data-scroll-target="#step-1-fit-the-initial-linear-regression-model">Step 1: Fit the initial linear regression model</a></li>
  <li><a href="#step-2-eliminate-the-least-significant-predictor" id="toc-step-2-eliminate-the-least-significant-predictor" class="nav-link" data-scroll-target="#step-2-eliminate-the-least-significant-predictor">Step 2: Eliminate the least significant predictor</a></li>
  <li><a href="#step-3-repeat-the-steps" id="toc-step-3-repeat-the-steps" class="nav-link" data-scroll-target="#step-3-repeat-the-steps">Step 3: Repeat the steps</a></li>
  <li><a href="#step-4-final-model" id="toc-step-4-final-model" class="nav-link" data-scroll-target="#step-4-final-model">Step 4: Final model</a></li>
  </ul></li>
  <li><a href="#part-2-automated-procedures-for-building-prediction-models" id="toc-part-2-automated-procedures-for-building-prediction-models" class="nav-link" data-scroll-target="#part-2-automated-procedures-for-building-prediction-models">Part 2: Automated procedures for building prediction models</a>
  <ul class="collapse">
  <li><a href="#exercise-automated-procedures-vs-manual-model" id="toc-exercise-automated-procedures-vs-manual-model" class="nav-link" data-scroll-target="#exercise-automated-procedures-vs-manual-model">Exercise: Automated procedures vs manual model</a></li>
  </ul></li>
  <li><a href="#part-3-causal-diagrams" id="toc-part-3-causal-diagrams" class="nav-link" data-scroll-target="#part-3-causal-diagrams">Part 3: Causal diagrams</a>
  <ul class="collapse">
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1">Exercise 1</a></li>
  <li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2">Exercise 2</a></li>
  <li><a href="#exercise-3" id="toc-exercise-3" class="nav-link" data-scroll-target="#exercise-3">Exercise 3</a></li>
  <li><a href="#exercise-4" id="toc-exercise-4" class="nav-link" data-scroll-target="#exercise-4">Exercise 4</a></li>
  <li><a href="#exercise-5" id="toc-exercise-5" class="nav-link" data-scroll-target="#exercise-5">Exercise 5</a></li>
  <li><a href="#exercise-6" id="toc-exercise-6" class="nav-link" data-scroll-target="#exercise-6">Exercise 6</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="lab7_answers.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Advanced Medical Statistics – Answers lab 7</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="part-1-building-prediction-models-using-backward-elimination" class="level2">
<h2 class="anchored" data-anchor-id="part-1-building-prediction-models-using-backward-elimination">Part 1: Building prediction models using backward elimination</h2>
<section id="step-1-fit-the-initial-linear-regression-model" class="level3">
<h3 class="anchored" data-anchor-id="step-1-fit-the-initial-linear-regression-model">Step 1: Fit the initial linear regression model</h3>
<p>Create an initial model for hospital length of stay (<code>los</code>) using the following predictors: <code>age</code>, <code>gender</code>, <code>hr</code>, <code>sysbp</code>, <code>diasbp</code>, <code>bmi</code>, <code>cvd</code>, <code>sho</code>. Run/summarize the model to inspect coefficients and p-values.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = los ~ age + gender + hr + sysbp + diasbp + bmi + 
    cvd + sho, data = whas)

Residuals:
   Min     1Q Median     3Q    Max 
-8.335 -2.653 -1.071  1.200 40.073 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   3.2648144  2.1394896   1.526 0.127659    
age           0.0031994  0.0168850   0.189 0.849792    
genderfemale  0.8575246  0.4489334   1.910 0.056698 .  
hr            0.0190577  0.0090828   2.098 0.036396 *  
sysbp        -0.0008358  0.0085656  -0.098 0.922304    
diasbp        0.0141799  0.0128884   1.100 0.271780    
bmi          -0.0304532  0.0427613  -0.712 0.476700    
cvdyes        0.3903925  0.4981468   0.784 0.433600    
shoyes        3.5265170  1.0329265   3.414 0.000693 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.632 on 491 degrees of freedom
Multiple R-squared:  0.04991,   Adjusted R-squared:  0.03443 
F-statistic: 3.224 on 8 and 491 DF,  p-value: 0.001388</code></pre>
</div>
</div>
</section>
<section id="step-2-eliminate-the-least-significant-predictor" class="level3">
<h3 class="anchored" data-anchor-id="step-2-eliminate-the-least-significant-predictor">Step 2: Eliminate the least significant predictor</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Anova Table (Type III tests)

Response: los
             Sum Sq  Df F value    Pr(&gt;F)    
(Intercept)    50.0   1  2.3286 0.1276592    
age             0.8   1  0.0359 0.8497924    
gender         78.3   1  3.6486 0.0566978 .  
hr             94.5   1  4.4025 0.0363962 *  
sysbp           0.2   1  0.0095 0.9223042    
diasbp         26.0   1  1.2105 0.2717799    
bmi            10.9   1  0.5072 0.4766997    
cvd            13.2   1  0.6142 0.4336001    
sho           250.1   1 11.6561 0.0006929 ***
Residuals   10535.8 491                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The ANOVA table shows that the predictor with the highest p-value is <code>sysbp</code> (<span class="math inline">\(p = 0.92\)</span>). Systolic blood pressure is the least significant predictor and should be removed from the model.</p>
</section>
<section id="step-3-repeat-the-steps" class="level3">
<h3 class="anchored" data-anchor-id="step-3-repeat-the-steps">Step 3: Repeat the steps</h3>
<p>The following variables are sequentially removed from the model (after initially removing <code>sysbp</code>):</p>
<ol type="1">
<li><code>age</code>: p-value = 0.86</li>
<li><code>cvd</code>: p-value = 0.41</li>
<li><code>bmi</code>: p-value = 0.44</li>
<li><code>diasbp</code>: p-value = 0.22</li>
</ol>
</section>
<section id="step-4-final-model" class="level3">
<h3 class="anchored" data-anchor-id="step-4-final-model">Step 4: Final model</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = los ~ gender + hr + sho, data = whas)

Residuals:
   Min     1Q Median     3Q    Max 
-8.663 -2.661 -1.064  1.136 40.826 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  3.796075   0.799047   4.751 2.66e-06 ***
genderfemale 0.910388   0.424827   2.143 0.032602 *  
hr           0.020680   0.008843   2.339 0.019751 *  
shoyes       3.550448   1.009081   3.518 0.000474 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.622 on 496 degrees of freedom
Multiple R-squared:  0.04443,   Adjusted R-squared:  0.03865 
F-statistic: 7.687 on 3 and 496 DF,  p-value: 4.976e-05</code></pre>
</div>
</div>
<section id="residual-plots" class="level4">
<h4 class="anchored" data-anchor-id="residual-plots">Residual plots</h4>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab7_answers_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab7_answers_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The overall fit of the model appears reasonable, as the residuals are generally centered around zero with no major patterns suggesting severe violations of linearity. However, there are some outliers with very long lengths of stay (LOS) that are not adequately captured by the model. These outliers lead to a right skew in the residual distribution, as seen in the histogram, influencing model fit. While the current model seems to work reasonably well for most observations, further steps (e.g., transformations or robust regression techniques) could be considered to better account for these extreme cases.</p>
</section>
</section>
</section>
<section id="part-2-automated-procedures-for-building-prediction-models" class="level2">
<h2 class="anchored" data-anchor-id="part-2-automated-procedures-for-building-prediction-models">Part 2: Automated procedures for building prediction models</h2>
<section id="exercise-automated-procedures-vs-manual-model" class="level3">
<h3 class="anchored" data-anchor-id="exercise-automated-procedures-vs-manual-model">Exercise: Automated procedures vs manual model</h3>
<section id="r" class="level4">
<h4 class="anchored" data-anchor-id="r">R</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(los <span class="sc">~</span> age <span class="sc">+</span> gender <span class="sc">+</span> hr <span class="sc">+</span> sysbp <span class="sc">+</span> diasbp <span class="sc">+</span> bmi <span class="sc">+</span> cvd <span class="sc">+</span> sho, <span class="at">data =</span> whas)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>step_model <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(fit, <span class="at">direction =</span> <span class="st">"backward"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=1541.96
los ~ age + gender + hr + sysbp + diasbp + bmi + cvd + sho

         Df Sum of Sq   RSS    AIC
- sysbp   1     0.204 10536 1540.0
- age     1     0.770 10537 1540.0
- bmi     1    10.883 10547 1540.5
- cvd     1    13.179 10549 1540.6
- diasbp  1    25.974 10562 1541.2
&lt;none&gt;                10536 1542.0
- gender  1    78.292 10614 1543.7
- hr      1    94.469 10630 1544.4
- sho     1   250.115 10786 1551.7

Step:  AIC=1539.97
los ~ age + gender + hr + diasbp + bmi + cvd + sho

         Df Sum of Sq   RSS    AIC
- age     1     0.682 10537 1538.0
- bmi     1    11.109 10547 1538.5
- cvd     1    12.975 10549 1538.6
- diasbp  1    38.551 10575 1539.8
&lt;none&gt;                10536 1540.0
- gender  1    78.719 10615 1541.7
- hr      1    96.991 10633 1542.6
- sho     1   260.543 10797 1550.2

Step:  AIC=1538.01
los ~ gender + hr + diasbp + bmi + cvd + sho

         Df Sum of Sq   RSS    AIC
- cvd     1    14.624 10551 1536.7
- bmi     1    15.372 10552 1536.7
- diasbp  1    37.888 10575 1537.8
&lt;none&gt;                10537 1538.0
- gender  1    84.736 10621 1540.0
- hr      1   101.448 10638 1540.8
- sho     1   264.134 10801 1548.4

Step:  AIC=1536.7
los ~ gender + hr + diasbp + bmi + sho

         Df Sum of Sq   RSS    AIC
- bmi     1    12.883 10564 1535.3
- diasbp  1    38.599 10590 1536.5
&lt;none&gt;                10551 1536.7
- gender  1    97.518 10649 1539.3
- hr      1    99.732 10651 1539.4
- sho     1   266.183 10818 1547.2

Step:  AIC=1535.31
los ~ gender + hr + diasbp + sho

         Df Sum of Sq   RSS    AIC
- diasbp  1    32.352 10597 1534.8
&lt;none&gt;                10564 1535.3
- hr      1   104.369 10669 1538.2
- gender  1   108.564 10673 1538.4
- sho     1   273.160 10837 1546.1

Step:  AIC=1534.84
los ~ gender + hr + sho

         Df Sum of Sq   RSS    AIC
&lt;none&gt;                10597 1534.8
- gender  1     98.11 10695 1537.5
- hr      1    116.84 10713 1538.3
- sho     1    264.48 10861 1545.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(step_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = los ~ gender + hr + sho, data = whas)

Residuals:
   Min     1Q Median     3Q    Max 
-8.663 -2.661 -1.064  1.136 40.826 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  3.796075   0.799047   4.751 2.66e-06 ***
genderfemale 0.910388   0.424827   2.143 0.032602 *  
hr           0.020680   0.008843   2.339 0.019751 *  
shoyes       3.550448   1.009081   3.518 0.000474 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.622 on 496 degrees of freedom
Multiple R-squared:  0.04443,   Adjusted R-squared:  0.03865 
F-statistic: 7.687 on 3 and 496 DF,  p-value: 4.976e-05</code></pre>
</div>
</div>
<p>The final model obtained from the automated procedure is identical to the manually created model in Part 1.</p>
</section>
<section id="spss" class="level4">
<h4 class="anchored" data-anchor-id="spss">SPSS</h4>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/lab7_SPSS_BW.PNG" class="img-fluid figure-img"></p>
<figcaption>SPSS results of the backward elimination procedure</figcaption>
</figure>
</div>
<p>The table above shows the variables eliminated at each step of the backward elimination procedure in SPSS. The final model obtained from the automated procedure is identical to the manually created model in Part 1.</p>
</section>
</section>
</section>
<section id="part-3-causal-diagrams" class="level2">
<h2 class="anchored" data-anchor-id="part-3-causal-diagrams">Part 3: Causal diagrams</h2>
<p>For each of the exercises below:</p>
<ul>
<li>Try solving the diagrams by hand by using the recipe from the lecture (see lecture slides on Brightspace)</li>
<li>Check your answer using the <a href="http://www.dagitty.net/dags.html">DAGitty webtool</a></li>
</ul>
<section id="exercise-1" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1">Exercise 1</h3>
<p>In the graph depicted below, for which variables do you need to adjust to assess the unconfounded effect of E on O (there may be several possibilities)?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/lab7_DAG1.PNG" class="img-fluid figure-img"></p>
<figcaption>DAG exercise 1</figcaption>
</figure>
</div>
<p><strong>Answer:</strong><br>
Following the recipe: after removing all arrows leaving E, there are several unblocked paths leading from E to O. Just like in the lecture, adjusting for v2 opens a backdoor path (E – v1 – v3 – O) This newly opened backdoor path needs to be closed by also conditioning on v1 or v3, or both. Hence, there are 3 options: (v1, v2, v3) ; (v1, v2) ; and finally, (v2, v3).</p>
</section>
<section id="exercise-2" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2">Exercise 2</h3>
<p>In the graph depicted below, what happens when you additionally adjust for <strong>v5</strong>?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/lab7_DAG2.PNG" class="img-fluid figure-img"></p>
<figcaption>DAG exercise 2</figcaption>
</figure>
</div>
<p><strong>Answer:</strong> When adjusting for v5, we are blocking the effect through this indirect path from E to O (v5 is a mediator between E and O). Instead of the total effect of E on O, we will be estimating the direct effect.</p>
<p>In DAGitty, when you set v5 to ‘adjusted’, the algorithm will say the following: “The total effect cannot be estimated due to adjustment for an intermediate or a descendant of an intermediate.”</p>
</section>
<section id="exercise-3" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3">Exercise 3</h3>
<p>This diagram is slightly different: <strong>v1</strong> now is the exposure. For which variables do you need toadjust to assess the unconfounded effect of <strong>v1</strong> on <strong>O</strong>?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/lab7_DAG3.PNG" class="img-fluid figure-img"></p>
<figcaption>DAG exercise 3</figcaption>
</figure>
</div>
<p><strong>Answer:</strong> No adjustment is needed: there are no backdoor paths (removing all arrows leaving v1 reveals no remaining unblocked path from v1 to O).</p>
</section>
<section id="exercise-4" class="level3">
<h3 class="anchored" data-anchor-id="exercise-4">Exercise 4</h3>
<p>Now, <strong>v2</strong> is the exposure. For which variables do you need to adjust to assess the total unconfounded effect of <strong>v2</strong> on <strong>O</strong>?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/lab7_DAG4.PNG" class="img-fluid figure-img"></p>
<figcaption>DAG exercise 4</figcaption>
</figure>
</div>
<p><strong>Answer:</strong> Following the recipe, there are three unblocked paths left after removing the arrows leaving v2:</p>
<ol type="a">
<li>v2 – v3 – O and</li>
<li>v2 – v1 – E – O</li>
<li>v2 - v1 – E -v5 - O</li>
</ol>
<p>Backdoor path a) can be closed by conditioning on v3.</p>
<p>Backdoor path b) can be closed by conditioning on v1 (but not by conditioning on E, as you would no longer be estimating the total effect by blocking the paths from v2 to O mediated by E).</p>
<p>In this case, you should therefore condition on v1 and v3.</p>
</section>
<section id="exercise-5" class="level3">
<h3 class="anchored" data-anchor-id="exercise-5">Exercise 5</h3>
<p>Back to the first DAG. However, <strong>v2</strong> is now unmeasured. Can we still obtain an unconfounded estimate of the effect of <strong>E</strong> on <strong>O</strong>?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/lab7_DAG5.PNG" class="img-fluid figure-img"></p>
<figcaption>DAG exercise 5</figcaption>
</figure>
</div>
<p><strong>Answer:</strong> No, we cannot close the backdoor path between E and O since v2 is unmeasured and cannot be corrected for.</p>
</section>
<section id="exercise-6" class="level3">
<h3 class="anchored" data-anchor-id="exercise-6">Exercise 6</h3>
<p>See the DAG below: you adjusted for <strong>v5</strong>. What would be the consequence of this action?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/lab7_DAG6.PNG" class="img-fluid figure-img"></p>
<figcaption>DAG exercise 6</figcaption>
</figure>
</div>
<p><strong>Answer:</strong> There is no consequence: conditioning on v5 cannot alter any of the estimated effects in the DAG (it is neither a confounder, collider, nor a mediator in the E-O relationship).</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>