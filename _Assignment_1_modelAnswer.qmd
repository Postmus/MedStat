---
title: "Assignment part 1"
subtitle: "Model answers for all research question combinations"
format:
  html:
    embed-resources: true
execute:
  warning: false
  message: false
  error: false
  eval: true
  echo: true
---

## Introduction

This document contains model answers for all four research question combinations from the lookup table. This allows us to verify that all combinations produce meaningful results.

| Last 2 digits | RQ1: Grouping variable | RQ2: Binary predictor |
|---------------|------------------------|------------------------|
| 00–24 | Chest pain type (`cp`) | Sex (`sex`) |
| 25–49 | Chest pain type (`cp`) | Fasting blood sugar (`fbs`) |
| 50–74 | Thalassemia (`thal`) | Sex (`sex`) |
| 75–99 | Thalassemia (`thal`) | Fasting blood sugar (`fbs`) |

```{r}
#| include: false

# Load the required libraries
library(haven)
library(dplyr)
library(ggplot2)
library(car)

# Load the SPSS file
heart_data <- read_sav("datasets/heart_disease_cleveland.sav")

# Convert all variables to factors where needed
heart_data <- heart_data |> mutate(across(where(is.labelled), as_factor))

# Set the random seed
set.seed(123456)

# Create an individualized dataset with 200 patients
heart_data <- heart_data[sample(nrow(heart_data), 200), ]
```

---

## Combination 1 (Last 2 digits: 00–24)

**RQ1**: Does maximum heart rate (`thalach`) differ across chest pain types (`cp`)?

**RQ2**: Is the presence of heart disease associated with sex (`sex`)?

### RQ1: Maximum heart rate by chest pain type

#### Boxplot

```{r}
ggplot(heart_data, aes(x = cp, y = thalach)) +
  geom_boxplot() +
  labs(x = "Chest pain type", y = "Maximum heart rate achieved",
       title = "Maximum heart rate by chest pain type") +
  theme_minimal()
```

#### Means and 95% CIs

```{r}
heart_data %>%
  group_by(cp) %>%
  summarise(
    n = n(),
    mean = mean(thalach, na.rm = TRUE),
    sd = sd(thalach, na.rm = TRUE),
    se = sd / sqrt(n),
    ci_lower = mean - qt(0.975, n - 1) * se,
    ci_upper = mean + qt(0.975, n - 1) * se
  )
```

#### Assumption checks

```{r}
# Histograms by group
ggplot(heart_data, aes(x = thalach)) +
  geom_histogram(bins = 15, fill = "steelblue", color = "white") +
  facet_wrap(~ cp) +
  labs(x = "Maximum heart rate", y = "Frequency") +
  theme_minimal()

# Levene's test
leveneTest(thalach ~ cp, data = heart_data)
```

#### One-way ANOVA and post-hoc tests

```{r}
anova_result <- aov(thalach ~ cp, data = heart_data)
summary(anova_result)

# Post-hoc with Bonferroni
pairwise.t.test(heart_data$thalach, heart_data$cp, p.adjust.method = "bonferroni")
```

### RQ2: Heart disease and sex

```{r}
# Contingency table
table(heart_data$sex, heart_data$target)

# Prevalence by group
prop.table(table(heart_data$sex, heart_data$target), margin = 1)

# Chi-square test
chisq.test(table(heart_data$sex, heart_data$target))

# Expected counts
chisq.test(table(heart_data$sex, heart_data$target))$expected
```

---

## Combination 2 (Last 2 digits: 25–49)

**RQ1**: Does maximum heart rate (`thalach`) differ across chest pain types (`cp`)?

**RQ2**: Is the presence of heart disease associated with fasting blood sugar (`fbs`)?

### RQ1: Maximum heart rate by chest pain type

*(Same analysis as Combination 1 - see above)*

### RQ2: Heart disease and fasting blood sugar

```{r}
# Contingency table
table(heart_data$fbs, heart_data$target)

# Prevalence by group
prop.table(table(heart_data$fbs, heart_data$target), margin = 1)

# Chi-square test
chisq.test(table(heart_data$fbs, heart_data$target))

# Expected counts
chisq.test(table(heart_data$fbs, heart_data$target))$expected
```

---

## Combination 3 (Last 2 digits: 50–74)

**RQ1**: Does maximum heart rate (`thalach`) differ across thalassemia categories (`thal`)?

**RQ2**: Is the presence of heart disease associated with sex (`sex`)?

### RQ1: Maximum heart rate by thalassemia

#### Boxplot

```{r}
heart_data %>%
  filter(!is.na(thal)) %>%
  ggplot(aes(x = thal, y = thalach)) +
  geom_boxplot() +
  labs(x = "Thalassemia", y = "Maximum heart rate achieved",
       title = "Maximum heart rate by thalassemia category") +
  theme_minimal()
```

#### Means and 95% CIs

```{r}
heart_data %>%
  filter(!is.na(thal)) %>%
  group_by(thal) %>%
  summarise(
    n = n(),
    mean = mean(thalach, na.rm = TRUE),
    sd = sd(thalach, na.rm = TRUE),
    se = sd / sqrt(n),
    ci_lower = mean - qt(0.975, n - 1) * se,
    ci_upper = mean + qt(0.975, n - 1) * se
  )
```

#### Assumption checks

```{r}
# Histograms by group
heart_data %>%
  filter(!is.na(thal)) %>%
  ggplot(aes(x = thalach)) +
  geom_histogram(bins = 15, fill = "steelblue", color = "white") +
  facet_wrap(~ thal) +
  labs(x = "Maximum heart rate", y = "Frequency") +
  theme_minimal()

# Levene's test
leveneTest(thalach ~ thal, data = heart_data)
```

#### One-way ANOVA and post-hoc tests

```{r}
anova_result <- aov(thalach ~ thal, data = heart_data)
summary(anova_result)

# Post-hoc with Bonferroni
pairwise.t.test(heart_data$thalach, heart_data$thal, p.adjust.method = "bonferroni")
```

### RQ2: Heart disease and sex

*(Same analysis as Combination 1 - see above)*

---

## Combination 4 (Last 2 digits: 75–99)

**RQ1**: Does maximum heart rate (`thalach`) differ across thalassemia categories (`thal`)?

**RQ2**: Is the presence of heart disease associated with fasting blood sugar (`fbs`)?

### RQ1: Maximum heart rate by thalassemia

*(Same analysis as Combination 3 - see above)*

### RQ2: Heart disease and fasting blood sugar

*(Same analysis as Combination 2 - see above)*

